<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DASA Hospitality - Admin Dashboard</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
      min-height: 100vh;
      color: white;
      padding: 20px;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      margin-bottom: 40px;
      padding: 30px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 16px;
      backdrop-filter: blur(10px);
    }

    .header h1 {
      font-size: 32px;
      margin-bottom: 10px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }

    .stat-card {
      background: rgba(255, 255, 255, 0.1);
      padding: 24px;
      border-radius: 12px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .stat-card h3 {
      font-size: 14px;
      opacity: 0.8;
      margin-bottom: 8px;
    }

    .stat-card .value {
      font-size: 32px;
      font-weight: bold;
      color: #4ade80;
    }

    .customers-section {
      background: rgba(255, 255, 255, 0.1);
      padding: 30px;
      border-radius: 16px;
      backdrop-filter: blur(10px);
    }

    .customers-section h2 {
      margin-bottom: 20px;
      font-size: 24px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      overflow: hidden;
    }

    th {
      background: rgba(255, 255, 255, 0.1);
      padding: 12px;
      text-align: left;
      font-weight: 600;
      border-bottom: 2px solid rgba(255, 255, 255, 0.2);
    }

    td {
      padding: 12px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    tr:hover {
      background: rgba(255, 255, 255, 0.05);
    }

    .badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
      background: rgba(74, 222, 128, 0.2);
      color: #4ade80;
    }

    .refresh-btn {
      background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      margin-bottom: 20px;
      transition: transform 0.2s;
    }

    .refresh-btn:hover {
      transform: translateY(-2px);
    }

    .loading {
      text-align: center;
      padding: 40px;
      font-size: 18px;
      opacity: 0.7;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üè® DASA Hospitality Admin Dashboard</h1>
      <p>Customer Data & Analytics</p>
    </div>

    <div class="stats-grid" id="statsGrid">
      <div class="stat-card">
        <h3>Total Customers</h3>
        <div class="value" id="totalCustomers">-</div>
      </div>
      <div class="stat-card">
        <h3>Average Time on Site</h3>
        <div class="value" id="avgTime">-</div>
      </div>
      <div class="stat-card">
        <h3>Top Source</h3>
        <div class="value" id="topSource">-</div>
      </div>
      <div class="stat-card">
        <h3>Mobile Users</h3>
        <div class="value" id="mobileUsers">-</div>
      </div>
    </div>

    <div class="customers-section">
      <button class="refresh-btn" onclick="loadData()">üîÑ Refresh Data</button>
      <h2>Customer Records</h2>
      <div id="tableContainer">
        <div class="loading">Loading customer data...</div>
      </div>
    </div>
  </div>

  <script>
    const API_URL = 'http://localhost:8001';

    function formatTime(seconds) {
      if (!seconds) return '0s';
      const mins = Math.floor(seconds / 60);
      const secs = seconds % 60;
      if (mins > 0) return `${mins}m ${secs}s`;
      return `${secs}s`;
    }

    function formatDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleString();
    }

    async function loadData() {
      try {
        // Load statistics
        const statsResponse = await fetch(`${API_URL}/api/customers/stats`);
        const statsData = await statsResponse.json();
        
        if (statsData.success) {
          const stats = statsData.stats;
          document.getElementById('totalCustomers').textContent = stats.total_customers || 0;
          document.getElementById('avgTime').textContent = formatTime(Math.floor(stats.avg_time_spent || 0));
          
          // Top source
          const sources = stats.source_breakdown || {};
          const topSource = Object.entries(sources).sort((a, b) => b[1] - a[1])[0];
          document.getElementById('topSource').textContent = topSource ? topSource[0] : 'N/A';
          
          // Mobile users
          const devices = stats.device_breakdown || {};
          const mobileCount = (devices['Mobile'] || 0) + (devices['Tablet'] || 0);
          document.getElementById('mobileUsers').textContent = mobileCount;
        }

        // Load customers
        const customersResponse = await fetch(`${API_URL}/api/customers/all`);
        const customersData = await customersResponse.json();
        
        if (customersData.success) {
          const customers = customersData.customers;
          
          if (customers.length === 0) {
            document.getElementById('tableContainer').innerHTML = '<div class="loading">No customer data yet</div>';
            return;
          }

          let tableHTML = `
            <table>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Name</th>
                  <th>Contact</th>
                  <th>Source</th>
                  <th>Device</th>
                  <th>IP Address</th>
                  <th>Time Spent</th>
                  <th>Created At</th>
                </tr>
              </thead>
              <tbody>
          `;

          customers.forEach(customer => {
            tableHTML += `
              <tr>
                <td>${customer.id}</td>
                <td><strong>${customer.name}</strong></td>
                <td>${customer.contact}</td>
                <td><span class="badge">${customer.source}</span></td>
                <td>${customer.device_type}</td>
                <td>${customer.ip_address || 'N/A'}</td>
                <td>${formatTime(customer.time_spent_seconds)}</td>
                <td>${formatDate(customer.created_at)}</td>
              </tr>
            `;
          });

          tableHTML += `
              </tbody>
            </table>
          `;

          document.getElementById('tableContainer').innerHTML = tableHTML;
        }
      } catch (error) {
        console.error('Error loading data:', error);
        document.getElementById('tableContainer').innerHTML = '<div class="loading">Error loading data. Make sure backend is running.</div>';
      }
    }

    // Load data on page load
    loadData();

    // Auto-refresh every 30 seconds
    setInterval(loadData, 30000);
  </script>
</body>
</html>
